<Window x:Class="aribeth.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:aribeth"
        mc:Ignorable="d"
        Title="Aribeth - Tlk and 2da Editor"
        Height="800"
        Width="1200"
        WindowState="Maximized"
        WindowStyle="None"
        Icon="pack://application:,,,/aribeth.png"
        AllowsTransparency="False">
    <Window.CommandBindings>
        <CommandBinding Command="ApplicationCommands.Undo" Executed="UndoCommand_Executed" CanExecute="Command_CanExecute"/>
        <CommandBinding Command="ApplicationCommands.Redo" Executed="RedoCommand_Executed" CanExecute="Command_CanExecute"/>
        <CommandBinding Command="ApplicationCommands.Copy" Executed="CopyCommand_Executed" CanExecute="Command_CanExecute"/>
        <CommandBinding Command="ApplicationCommands.Cut" Executed="CutCommand_Executed" CanExecute="Command_CanExecute"/>
        <CommandBinding Command="ApplicationCommands.Paste" Executed="PasteCommand_Executed" CanExecute="Command_CanExecute"/>
        <CommandBinding Command="ApplicationCommands.Find" Executed="FindCommand_Executed" CanExecute="Command_CanExecute"/>
        <CommandBinding Command="ApplicationCommands.Replace" Executed="ReplaceCommand_Executed" CanExecute="Command_CanExecute"/>
        <CommandBinding Command="ApplicationCommands.Open" Executed="OpenCommand_Executed" CanExecute="Command_CanExecute"/>
        <CommandBinding Command="ApplicationCommands.Save" Executed="SaveCommand_Executed" CanExecute="Command_CanExecute"/>
        <CommandBinding Command="ApplicationCommands.SaveAs" Executed="SaveAsCommand_Executed" CanExecute="Command_CanExecute"/>
    </Window.CommandBindings>
    <Window.InputBindings>
        <KeyBinding Command="ApplicationCommands.Open" Key="O" Modifiers="Control"/>
        <KeyBinding Command="ApplicationCommands.Save" Key="S" Modifiers="Control"/>
        <KeyBinding Command="ApplicationCommands.SaveAs" Key="S" Modifiers="Control+Shift"/>
        <KeyBinding Command="ApplicationCommands.Undo" Key="Z" Modifiers="Control"/>
        <KeyBinding Command="ApplicationCommands.Redo" Key="Y" Modifiers="Control"/>
        <KeyBinding Command="ApplicationCommands.Copy" Key="C" Modifiers="Control"/>
        <KeyBinding Command="ApplicationCommands.Cut" Key="X" Modifiers="Control"/>
        <KeyBinding Command="ApplicationCommands.Paste" Key="V" Modifiers="Control"/>
        <KeyBinding Command="ApplicationCommands.Find" Key="F" Modifiers="Control"/>
        <KeyBinding Command="ApplicationCommands.Replace" Key="H" Modifiers="Control"/>
    </Window.InputBindings>
    <Window.Resources>
        <SolidColorBrush x:Key="WindowBackgroundBrush" Color="#1E1F22"/>
        <SolidColorBrush x:Key="ControlBackgroundBrush" Color="#2B2D31"/>
        <SolidColorBrush x:Key="ControlBorderBrush" Color="#34363D"/>
        <SolidColorBrush x:Key="ControlForegroundBrush" Color="#DBDEE1"/>
        <SolidColorBrush x:Key="AccentBrush" Color="#5865F2"/>
        <SolidColorBrush x:Key="RowHoverBrush" Color="#2F3136"/>
        <SolidColorBrush x:Key="RowSelectedBrush" Color="#3D4148"/>
        <SolidColorBrush x:Key="{x:Static SystemColors.MenuBrushKey}" Color="#1E1F22"/>
        <SolidColorBrush x:Key="{x:Static SystemColors.MenuTextBrushKey}" Color="#DBDEE1"/>
        <SolidColorBrush x:Key="{x:Static SystemColors.MenuHighlightBrushKey}" Color="#1A1B1E"/>

        <Style TargetType="Window">
            <Setter Property="Background" Value="{StaticResource WindowBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ControlForegroundBrush}"/>
        </Style>

        <Style TargetType="Menu">
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ControlForegroundBrush}"/>
        </Style>

        <Style x:Key="SubMenuItemStyle" TargetType="MenuItem">
            <Setter Property="Background" Value="#1E1F22"/>
            <Setter Property="Foreground" Value="{StaticResource ControlForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="#141517"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,3"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="MenuItem">
                        <Grid>
                            <Border x:Name="Border"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    Padding="{TemplateBinding Padding}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <ContentPresenter Grid.Column="1"
                                                      ContentSource="Header"
                                                      RecognizesAccessKey="True"
                                                      VerticalAlignment="Center"/>
                                    <Path x:Name="Arrow"
                                          Grid.Column="2"
                                          Margin="6,0,0,0"
                                          Fill="{TemplateBinding Foreground}"
                                          Data="M 0 0 L 4 4 L 0 8 Z"
                                          Visibility="Collapsed"
                                          VerticalAlignment="Center"/>
                                </Grid>
                            </Border>
                            <Popup x:Name="Popup"
                                   Placement="Right"
                                   IsOpen="{TemplateBinding IsSubmenuOpen}"
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   PopupAnimation="Fade">
                                <Border Background="#1E1F22"
                                        BorderBrush="#141517"
                                        BorderThickness="1"
                                        Padding="2">
                                    <StackPanel IsItemsHost="True"
                                                KeyboardNavigation.DirectionalNavigation="Cycle"/>
                                </Border>
                            </Popup>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#1A1B1E"/>
                            </Trigger>
                            <Trigger Property="IsSubmenuOpen" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#141517"/>
                            </Trigger>
                            <Trigger Property="Role" Value="SubmenuHeader">
                                <Setter TargetName="Arrow" Property="Visibility" Value="Visible"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Border" Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="TopLevelMenuItemStyle" TargetType="MenuItem">
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ControlForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="#141517"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,3"/>
            <Setter Property="ItemContainerStyle" Value="{StaticResource SubMenuItemStyle}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="MenuItem">
                        <Grid>
                            <Border x:Name="Border"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    Padding="{TemplateBinding Padding}">
                                <ContentPresenter ContentSource="Header"
                                                  RecognizesAccessKey="True"
                                                  HorizontalAlignment="Center"
                                                  VerticalAlignment="Center"/>
                            </Border>
                            <Popup x:Name="Popup"
                                   Placement="Bottom"
                                   IsOpen="{TemplateBinding IsSubmenuOpen}"
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   PopupAnimation="Fade">
                                <Border Background="#1E1F22"
                                        BorderBrush="#141517"
                                        BorderThickness="1"
                                        Padding="2">
                                    <StackPanel IsItemsHost="True"
                                                KeyboardNavigation.DirectionalNavigation="Cycle"/>
                                </Border>
                            </Popup>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#1A1B1E"/>
                            </Trigger>
                            <Trigger Property="IsSubmenuOpen" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#141517"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Border" Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="ContextMenu">
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ControlForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource ControlBorderBrush}"/>
        </Style>

        <Style TargetType="ToolBar">
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ControlForegroundBrush}"/>
        </Style>

        <Style TargetType="Button">
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ControlForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource ControlBorderBrush}"/>
            <Setter Property="Padding" Value="6,2"/>
        </Style>

        <Style TargetType="TextBox">
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ControlForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource ControlBorderBrush}"/>
            <Setter Property="CaretBrush" Value="{StaticResource AccentBrush}"/>
        </Style>

        <Style TargetType="ComboBox">
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ControlForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource ControlBorderBrush}"/>
        </Style>

        <Style TargetType="CheckBox">
            <Setter Property="Foreground" Value="{StaticResource ControlForegroundBrush}"/>
        </Style>

        <Style TargetType="StatusBar">
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ControlForegroundBrush}"/>
        </Style>

        <Style TargetType="TabControl">
            <Setter Property="Background" Value="{StaticResource WindowBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ControlForegroundBrush}"/>
        </Style>

        <Style TargetType="DataGrid">
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ControlForegroundBrush}"/>
            <Setter Property="GridLinesVisibility" Value="All"/>
            <Setter Property="BorderBrush" Value="{StaticResource ControlBorderBrush}"/>
            <Setter Property="RowBackground" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="AlternatingRowBackground" Value="{StaticResource WindowBackgroundBrush}"/>
        </Style>

        <Style TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ControlForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource ControlBorderBrush}"/>
        </Style>

        <Style TargetType="DataGridRow">
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ControlForegroundBrush}"/>
        </Style>

        <Style TargetType="DataGridCell">
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ControlForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource ControlBorderBrush}"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{StaticResource RowSelectedBrush}"/>
                    <Setter Property="Foreground" Value="{StaticResource ControlForegroundBrush}"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource RowHoverBrush}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style TargetType="TabItem">
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ControlForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource ControlBorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="10,4"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabItem">
                        <Border x:Name="TabBorder"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter ContentSource="Header"
                                              HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="TabBorder" Property="Background" Value="#141517"/>
                                <Setter TargetName="TabBorder" Property="BorderBrush" Value="{StaticResource ControlBorderBrush}"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="TabBorder" Property="Background" Value="#1F2126"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="TabBorder" Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="TabPanel">
            <Setter Property="Background" Value="{StaticResource WindowBackgroundBrush}"/>
        </Style>

        <Style TargetType="Grid">
            <Setter Property="Background" Value="{StaticResource WindowBackgroundBrush}"/>
        </Style>

        <Style TargetType="StackPanel">
            <Setter Property="Background" Value="{StaticResource WindowBackgroundBrush}"/>
        </Style>

        <Style TargetType="DockPanel">
            <Setter Property="Background" Value="{StaticResource WindowBackgroundBrush}"/>
        </Style>

        <Style x:Key="ToolbarButtonStyle" TargetType="Button">
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="MinWidth" Value="60"/>
            <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ControlForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource ControlBorderBrush}"/>
        </Style>
    </Window.Resources>

    <DockPanel>
        <Grid DockPanel.Dock="Top" Height="32" Background="{StaticResource WindowBackgroundBrush}" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBlock Text="Aribeth - Tlk and 2da Editor"
                       VerticalAlignment="Center"
                       Margin="10,0,0,0"
                       Foreground="{StaticResource ControlForegroundBrush}"/>
            <Button Grid.Column="1" Content="—" Width="40" Click="MinimizeButton_Click" Style="{StaticResource ToolbarButtonStyle}"/>
            <Button Grid.Column="2" Content="▢" Width="40" Click="MaximizeButton_Click" Style="{StaticResource ToolbarButtonStyle}"/>
            <Button Grid.Column="3" Content="✕" Width="40" Click="CloseButton_Click" Style="{StaticResource ToolbarButtonStyle}"/>
        </Grid>
        <Menu DockPanel.Dock="Top" ItemContainerStyle="{StaticResource TopLevelMenuItemStyle}">
            <MenuItem Header="_File">
                <MenuItem Header="_Open 2DA..." Click="Open2DAMenuItem_Click"/>
                <MenuItem Header="Open _TLK..." Click="OpenTLKMenuItem_Click"/>
                <MenuItem Header="_Close Current" Click="CloseCurrentMenuItem_Click"/>
                <Separator/>
                <MenuItem Header="_Save" Click="SaveMenuItem_Click"/>
                <MenuItem Header="Save _As..." Click="SaveAsMenuItem_Click"/>
                <Separator/>
                <MenuItem Header="E_xit" Click="ExitMenuItem_Click"/>
            </MenuItem>
            <MenuItem Header="_Edit">
                <MenuItem Header="_Undo" Click="UndoMenuItem_Click" InputGestureText="Ctrl+Z"/>
                <MenuItem Header="_Redo" Click="RedoMenuItem_Click" InputGestureText="Ctrl+Y"/>
                <Separator/>
                <MenuItem Header="_Copy Row" Click="CopyRowMenuItem_Click" InputGestureText="Ctrl+C"/>
                <MenuItem Header="C_ut Row" Click="CutRowMenuItem_Click" InputGestureText="Ctrl+X"/>
                <MenuItem Header="_Paste Row" Click="PasteRowMenuItem_Click" InputGestureText="Ctrl+V"/>
                <Separator/>
                <MenuItem Header="_Add Column..." Click="AddColumnMenuItem_Click"/>
                <MenuItem Header="_Remove Column..." Click="RemoveColumnMenuItem_Click"/>
                <Separator/>
                <MenuItem Header="_Find..." Click="FindMenuItem_Click" InputGestureText="Ctrl+F"/>
                <MenuItem Header="_Replace..." Click="ReplaceMenuItem_Click" InputGestureText="Ctrl+H"/>
            </MenuItem>
            <MenuItem Header="_Tools">
                <MenuItem Header="_Normalize 2DA" Click="Normalize2DAMenuItem_Click"/>
                <MenuItem Header="_Merge 2DA..." Click="Merge2DAMenuItem_Click"/>
                <MenuItem Header="Check _Issues" Click="CheckIssuesMenuItem_Click"/>
                <Separator/>
                <MenuItem Header="Export TLK to _JSON..." Click="ExportTLKToJsonMenuItem_Click"/>
                <MenuItem Header="Import TLK from _JSON..." Click="ImportTLKFromJsonMenuItem_Click"/>
                <MenuItem Header="Export TLK to _Binary..." Click="ExportTLKToBinaryMenuItem_Click"/>
            </MenuItem>
        </Menu>

        <ToolBar DockPanel.Dock="Top">
            <Button Content="Open" Click="OpenButton_Click" Style="{StaticResource ToolbarButtonStyle}"/>
            <Button Content="Save" Click="SaveButton_Click" Style="{StaticResource ToolbarButtonStyle}"/>
            <Button Content="Close" Click="CloseCurrentButton_Click" Style="{StaticResource ToolbarButtonStyle}"/>
            <Separator/>
            <Button Content="Copy" Click="CopyButton_Click" Style="{StaticResource ToolbarButtonStyle}"/>
            <Button Content="Paste" Click="PasteButton_Click" Style="{StaticResource ToolbarButtonStyle}"/>
            <Button Content="Cut" Click="CutButton_Click" Style="{StaticResource ToolbarButtonStyle}"/>
            <Separator/>
            <Button Content="Find" Click="FindButton_Click" Style="{StaticResource ToolbarButtonStyle}"/>
            <Button Content="Replace" Click="ReplaceButton_Click" Style="{StaticResource ToolbarButtonStyle}"/>
            <Separator/>
            <Button Content="Add Col" Click="AddColumnButton_Click" Style="{StaticResource ToolbarButtonStyle}"/>
            <Button Content="Remove Col" Click="RemoveColumnButton_Click" Style="{StaticResource ToolbarButtonStyle}"/>
        </ToolBar>

        <StatusBar DockPanel.Dock="Bottom">
            <StatusBarItem>
                <TextBlock x:Name="StatusTextBlock" Text="Ready"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="FileInfoTextBlock" Text="No file loaded"/>
            </StatusBarItem>
        </StatusBar>

        <TabControl x:Name="MainTabControl">
            <TabItem Header="2DA Editor">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5">
                        <TextBlock Text="Columns:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                        <TextBox x:Name="ColumnFilterTextBox"
                                 Width="150"
                                 Margin="0,0,10,0"
                                 TextChanged="ColumnFilterTextBox_TextChanged"
                                 ToolTip="Filter columns (supports regex)"/>
                        <TextBlock Text="Search:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                        <TextBox x:Name="SearchTextBox"
                                 Width="200"
                                 Margin="0,0,10,0"
                                 TextChanged="SearchTextBox_TextChanged"
                                 KeyDown="SearchTextBox_KeyDown"
                                 ToolTip="Search in all cells (supports regex and wildcards)"/>
                        <CheckBox x:Name="RegexCheckBox" Content="Regex" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <CheckBox x:Name="WildcardCheckBox" Content="Wildcards" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <TextBlock Text="Replace:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                        <TextBox x:Name="ReplaceTextBox"
                                 Width="200"
                                 Margin="0,0,10,0"
                                 ToolTip="Replace text (supports wildcards when enabled)"/>
                        <Button Content="Clear Filters" Click="ClearFiltersButton_Click" Margin="10,0,0,0"/>
                    </StackPanel>

                    <Grid Grid.Row="1" Margin="5">
                        <Image x:Name="TwoDaEmptyStateImage"
                               Source="pack://application:,,,/aribeth.png"
                               Width="300"
                               Height="300"
                               Stretch="Uniform"
                               Opacity="0.6"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               IsHitTestVisible="False"/>
                        <DataGrid x:Name="DataGrid2DA"
                                  Panel.ZIndex="1"
                                  AutoGenerateColumns="True"
                                  CanUserAddRows="True"
                                  CanUserDeleteRows="True"
                                  CanUserReorderColumns="True"
                                  CanUserResizeColumns="True"
                                  CanUserSortColumns="True"
                                  SelectionMode="Extended"
                                  SelectionUnit="CellOrRowHeader"
                                  ClipboardCopyMode="ExcludeHeader"
                                  RowHeaderWidth="40"
                                  EnableRowVirtualization="True"
                                  EnableColumnVirtualization="True"
                                  VirtualizingPanel.IsVirtualizing="True"
                                  VirtualizingPanel.VirtualizationMode="Recycling"
                                  VirtualizingPanel.CacheLength="2"
                                  VirtualizingPanel.CacheLengthUnit="Item"
                                  ScrollViewer.IsDeferredScrollingEnabled="True"
                                  ScrollViewer.CanContentScroll="True"
                                  FrozenColumnCount="2"
                                  HeadersVisibility="All">
                            <DataGrid.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="Copy Row" Click="CopyRowContextMenuItem_Click"/>
                                    <MenuItem Header="Cut Row" Click="CutRowContextMenuItem_Click"/>
                                    <MenuItem Header="Paste Row" Click="PasteRowContextMenuItem_Click"/>
                                    <Separator/>
                                    <MenuItem Header="Insert Row Above" Click="InsertRowAboveContextMenuItem_Click"/>
                                    <MenuItem Header="Insert Row Below" Click="InsertRowBelowContextMenuItem_Click"/>
                                    <MenuItem Header="Delete Row" Click="DeleteRowContextMenuItem_Click"/>
                                </ContextMenu>
                            </DataGrid.ContextMenu>
                        </DataGrid>
                    </Grid>
                </Grid>
            </TabItem>

            <TabItem Header="TLK Editor">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5">
                        <TextBlock Text="Search:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                        <TextBox x:Name="TLKSearchTextBox"
                                 Width="300"
                                 Margin="0,0,10,0"
                                 TextChanged="TLKSearchTextBox_TextChanged"
                                 KeyDown="TLKSearchTextBox_KeyDown"
                                 ToolTip="Search in TLK entries (supports regex)"/>
                        <CheckBox x:Name="TLKRegexCheckBox" Content="Regex" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <CheckBox x:Name="TLKCaseSensitiveCheckBox" Content="Case Sensitive" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <TextBlock Text="Filter by Sound:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                        <ComboBox x:Name="TLKSoundFilterComboBox" Width="120" Margin="0,0,10,0">
                            <ComboBoxItem Content="All"/>
                            <ComboBoxItem Content="Has Sound"/>
                            <ComboBoxItem Content="No Sound"/>
                        </ComboBox>
                        <CheckBox x:Name="TLKRawModeCheckBox"
                                  Content="Raw JSON"
                                  VerticalAlignment="Center"
                                  Margin="0,0,10,0"
                                  Checked="TLKRawModeCheckBox_Checked"
                                  Unchecked="TLKRawModeCheckBox_Unchecked"/>
                        <TextBlock Text="Go to Index:" VerticalAlignment="Center" Margin="10,0,5,0"/>
                        <TextBox x:Name="TLKIndexTextBox"
                                 Width="100"
                                 Margin="0,0,6,0"
                                 KeyDown="TLKIndexTextBox_KeyDown"
                                 ToolTip="Enter TLK index (e.g. 16777216)"/>
                        <Button Content="Go" Click="TLKGoToIndexButton_Click" Margin="0,0,10,0"/>
                        <Button Content="Clear Filters" Click="TLKClearFiltersButton_Click"/>
                    </StackPanel>

                    <Grid Grid.Row="1" Margin="5">
                        <Image x:Name="TlkEmptyStateImage"
                               Source="pack://application:,,,/aribeth.png"
                               Width="300"
                               Height="300"
                               Stretch="Uniform"
                               Opacity="0.6"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               IsHitTestVisible="False"/>
                        <DataGrid x:Name="DataGridTLK"
                                  Panel.ZIndex="1"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  CanUserReorderColumns="True"
                                  CanUserResizeColumns="True"
                                  CanUserSortColumns="True"
                                  SelectionMode="Single"
                                  MinRowHeight="24"
                                  EnableRowVirtualization="True"
                                  EnableColumnVirtualization="True"
                                  VirtualizingPanel.IsVirtualizing="True"
                                  VirtualizingPanel.VirtualizationMode="Recycling"
                                  VirtualizingPanel.CacheLength="2"
                                  VirtualizingPanel.CacheLengthUnit="Item"
                                  ScrollViewer.IsDeferredScrollingEnabled="True"
                                  ScrollViewer.CanContentScroll="True"
                                  HeadersVisibility="All">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Index" Binding="{Binding Index}" Width="90" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Length" Binding="{Binding Length}" Width="80" IsReadOnly="True"/>
                                <DataGridTemplateColumn Header="Text" Width="*">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Text}"
                                                       TextWrapping="Wrap"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                    <DataGridTemplateColumn.CellEditingTemplate>
                                        <DataTemplate>
                                            <TextBox Text="{Binding Text, UpdateSourceTrigger=PropertyChanged}"
                                                     AcceptsReturn="True"
                                                     TextWrapping="Wrap"
                                                     VerticalScrollBarVisibility="Auto"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellEditingTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn Header="SoundResRef" Binding="{Binding SoundResRef}" Width="150" IsReadOnly="False"/>
                                <DataGridTextColumn Header="Duration" Binding="{Binding Duration}" Width="100" IsReadOnly="False"/>
                            </DataGrid.Columns>
                        </DataGrid>

                        <TextBox x:Name="TLKRawTextBox"
                                 Panel.ZIndex="1"
                                 Visibility="Collapsed"
                                 AcceptsReturn="True"
                                 AcceptsTab="True"
                                 VerticalScrollBarVisibility="Auto"
                                 HorizontalScrollBarVisibility="Auto"
                                 FontFamily="Consolas"
                                 FontSize="11"
                                 IsReadOnly="True"/>
                    </Grid>
                </Grid>
            </TabItem>

            <TabItem Header="Log">
                <Grid>
                    <TextBox x:Name="LogTextBox"
                             IsReadOnly="True"
                             VerticalScrollBarVisibility="Auto"
                             HorizontalScrollBarVisibility="Auto"
                             FontFamily="Consolas"
                             FontSize="10"
                             Margin="5"/>
                </Grid>
            </TabItem>
        </TabControl>
    </DockPanel>
</Window>
